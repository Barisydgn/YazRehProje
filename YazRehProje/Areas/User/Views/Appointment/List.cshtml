@model IEnumerable<Appointment>
@{
    ViewData["Title"] = "List";
    Layout = "~/Areas/User/Views/Shared/_UserLayout.cshtml";
}

<h1 class="fw-bolder text-center" style="color:darkred">Randevu Listesi</h1>

<div>
    <label for="selectedDate">Tarih Seçin:</label>
    <input type="date" id="selectedDate" />
    <button id="filterButton">Filtrele</button>
</div>

<div id="filteredAppointments"></div>


    


@section scripts{
    <script>
        //$(document).ready(function () {
        //    $("#filterButton").click(function () {
        //        let date = $("#selectedDate").val();

        //        $.ajax({
        //            contentType: "application/json",
        //            dataType: "json",
        //            type: "get",
        //            url: "/User/Appointment/Ajax",
        //            data: { selectedDate: date },
        //            success: function (func) {
        //                let appointments = jQuery.parseJSON(func);

        //                let tablehtml =
        //                    "<table class='table table-dark'><tr><th>#</th><th>Tarih</th><th>Saat</th><th>Ad Soyad</th><th>Bos Mu</th><th>İşlem</th></tr>";

        //                $.each(appointments, function (index, value) {
        //                    let bosDoluContent = "";
        //                    let shortDate = new Date(value.AppointmentDate).toLocaleDateString();

        //                    if (value.BosDolu) {
        //                        bosDoluContent = "Boş";
        //                    } else {
        //                        bosDoluContent = "Dolu";
        //                    }

        //                    tablehtml += `<tr><td>${value.AppointmentId}</td><td>${shortDate}</td><td>${value.AppointmentTime}</td><td>${value.StudentName} ${value.StudentSurname}</td><td>${bosDoluContent}</td>
        //                                     <td><button  class="btn btn-success updateAppointment" data-appointment-id="${value.AppointmentId}" data-other-info="${value.OtherInfo}">Randevu Al</button></td>
        //                            </tr>`;
        //                });

        //                tablehtml += "</table>";
        //                $("#filteredAppointments").html(tablehtml);

        //                // Yeni eklenen kısım başlangıcı
        //                $(".updateAppointment").click(function () {
        //                    let appointmentId = $(this).data('appointment-id');
        //                    let otherInfo = $(this).data('other-info');

        //                    // Başka bir sayfaya yönlendir
        //                    window.location.href = `/User/Appointment/CreateAppointment?appointmentId=${appointmentId}&otherInfo=${otherInfo}`;
        //                });
        //                // Yeni eklenen kısım sonu
        //            },
        //            error: function (xhr, status, error) {
        //                console.error(xhr.responseText);
        //            },
        //        });
        //    });
        //});


        $(document).ready(function () {
            $("#filterButton").click(function () {
                let date = $("#selectedDate").val();

                $.ajax({
                    contentType: "application/json",
                    dataType: "json",
                    type: "get",
                    url: "/User/Appointment/Ajax",
                    data: { selectedDate: date },
                    success: function (func) {
                        let appointments = jQuery.parseJSON(func);

                        let tablehtml =
                            "<table class='table table-dark'><tr><th>#</th><th>Tarih</th><th>Saat</th><th>Ad Soyad</th><th>Bos Mu</th><th>İşlem</th></tr>";

                        $.each(appointments, function (index, value) {
                            let shortDate = new Date(value.AppointmentDate).toLocaleDateString();

                            // Sadece boş olan randevuları filtrele
                            if (value.BosDolu) {
                                let bosDoluContent = "Boş";

                                tablehtml += `<tr><td>${value.AppointmentId}</td><td>${shortDate}</td><td>${value.AppointmentTime}</td><td>${value.StudentName} ${value.StudentSurname}</td><td>${bosDoluContent}</td>
                                                        <td><button  class="btn btn-success updateAppointment" data-appointment-id="${value.AppointmentId}" data-other-info="${value.OtherInfo}"><i class="fa fa-arrow-right" aria-hidden="true"></i>     Randevu Al</button></td>
                                            </tr>`;
                            }
                        });

                        tablehtml += "</table>";
                        $("#filteredAppointments").html(tablehtml);

                        // Yeni eklenen kısım başlangıcı
                        $(".updateAppointment").click(function () {
                            let appointmentId = $(this).data('appointment-id');
                            let otherInfo = $(this).data('other-info');

                            // Başka bir sayfaya yönlendir
                            window.location.href = `/User/Appointment/CreateAppointment?appointmentId=${appointmentId}&otherInfo=${otherInfo}`;
                        });
                        // Yeni eklenen kısım sonu
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                    },
                });
            });
        });
    
    </script>
}